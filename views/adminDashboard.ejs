<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - Bike Rental</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    /* Reset & base */
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
    html, body { height:100%; }
    body {
      background:#f4f4f9; color:#333; line-height:1.6;
      display:flex; flex-direction:column;
    }

    /* Header/Navbar */
    header {
      background:#1e1e2f; color:#fff; padding:15px 5%; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;
      box-shadow:0 2px 8px rgba(0,0,0,0.2);
    }
    header h1 { color:#ff6b6b; font-size:2rem; }
    header nav { display:flex; gap:15px; flex-wrap:wrap; }
    header nav a {
      color:#fff; text-decoration:none; padding:8px 16px; border-radius:6px; transition:0.3s; font-weight:500;
    }
    header nav a:hover { background:#ff6b6b; }

    /* MAIN center fix */
    main.container {
      width:90%; max-width:1200px; margin:auto;
      flex-grow:1; padding:25px 0;
      display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
      text-align:center;
    }

    h2 { margin:20px 0; color:#1e1e2f; }

    /* Buttons */
    .btn {
      display:inline-block; padding:6px 12px; border:none; border-radius:6px; color:#fff;
      background:#ff6b6b; cursor:pointer; transition:0.3s; text-decoration:none; font-weight:500; font-size:0.9rem;
    }
    .btn:hover { background:#ff4b4b; }
    .btn.small { padding:4px 8px; font-size:0.8rem; }
    .btn.danger { background:#e63946; }
    .btn.danger:hover { background:#c5303f; }

    /* Table */
    table { width:100%; border-collapse:collapse; margin:30px auto; }
    table th, table td { padding:12px 15px; border-bottom:1px solid #ddd; text-align:center; }
    table th { background:#ff6b6b; color:#fff; font-weight:600; }
    table tr:hover { background:#f1f1f1; }
    .small-note { font-size:0.8rem; color:#777; }

    /* Cards */
    .card {
      background:#fff; padding:15px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1);
      margin:10px 0; width:100%; max-width:450px;
    }

    /* FOOTER Always Bottom */
    footer {
      background:#1e1e2f; color:#fff; padding:30px 5%; margin-top:auto;
      display:flex; flex-wrap:wrap; justify-content:space-between; gap:20px;
    }
    footer .footer-section { flex:1; min-width:200px; }
    footer h3 { color:#ff6b6b; margin-bottom:10px; }
    footer p, footer a { color:#fff; font-size:0.9rem; text-decoration:none; }
    footer a:hover { text-decoration:underline; }

    /* Responsive */
    @media (max-width:768px){
      table, thead, tbody, th, td, tr { display:block; }
      table tr { margin-bottom:15px; }
      table td { padding-left:50%; position:relative; text-align:left; }
      table td::before {
        position:absolute; top:12px; left:12px; width:45%; white-space:nowrap; font-weight:bold;
      }
      table td:nth-of-type(1)::before { content:"User/Bike"; }
      table td:nth-of-type(2)::before { content:"Bike/Price"; }
      table td:nth-of-type(3)::before { content:"Days"; }
      table td:nth-of-type(4)::before { content:"Pickup Date & Time"; }
      table td:nth-of-type(5)::before { content:"Return Date"; }
      table td:nth-of-type(6)::before { content:"Total"; }
      table td:nth-of-type(7)::before { content:"Status"; }
      table td:nth-of-type(8)::before { content:"Action"; }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <h1>BikeRental</h1>
    <nav>
      <a href="/">Home</a>
      <a href="/logout">Logout</a>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <main class="container">

    <h2>Manage Bikes</h2>
    <a class="btn" href="/admin/add-bike">+ Add Bike</a>
    <br><br>

    <% if (!bikes || bikes.length === 0) { %>
      <div class="card">No bikes.</div>
    <% } else { %>
      <table>
        <tr><th>Name</th><th>Price</th><th>Available</th><th>Actions</th></tr>
        <% bikes.forEach(b => { %>
          <tr>
            <td><%= b.name %></td>
            <td>₹ <%= b.pricePerDay %></td>
            <td><%= b.isAvailable ? "Yes" : "No" %></td>
            <td>
              <a class="btn small" href="/admin/edit-bike/<%= b._id %>">Edit</a>
              <form style="display:inline" action="/admin/delete-bike/<%= b._id %>" method="POST">
                <button class="btn small danger" type="submit">Delete</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </table>
    <% } %>

    <h2>Booking Requests</h2>
    <% if (!bookings || bookings.length === 0) { %>
      <div class="card">No booking requests.</div>
    <% } else { %>
      <table>
        <tr>
          <th>User</th>
          <th>Bike</th>
          <th>Days</th>
          <th>Request-Date-Time</th>
          <th>Return Date</th>
          <th>Total</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
        <% bookings.forEach(bk => { %>
          <tr>
            <td><%= bk.user ? bk.user.name : "Deleted user" %></td>
            <td><%= bk.bike ? bk.bike.name : "Deleted bike" %></td>
            <td><%= bk.days %></td>
            <td><%= bk.createdAt ? new Date(bk.createdAt).toLocaleString() : "N/A" %></td>

            <!-- Return Date -->
            <td>
              <% if (bk.createdAt && bk.days) { 
                   let returnDate = new Date(bk.createdAt);
                   returnDate.setDate(returnDate.getDate() + bk.days);
              %>
                <%= returnDate.toLocaleDateString() %>
              <% } else { %>
                N/A
              <% } %>
            </td>

            <td>₹ <%= bk.totalPrice %></td>
            <td><%= bk.status %></td>
            <td>
              <% if (bk.status === 'pending') { %>
                <a class="btn small" href="/admin/approve/<%= bk._id %>">Approve</a>
                <a class="btn small danger" href="/admin/reject/<%= bk._id %>">Reject</a>
              <% } else { %>
                <span class="small-note"><%= bk.status %></span>
              <% } %>
            </td>
          </tr>
        <% }) %>
      </table>
    <% } %>
  </main>

  <!-- FOOTER -->
  <footer>
    <div class="footer-section">
      <h3>BikeRental</h3>
      <p>Your trusted bike rental service.</p>
      <p>© <%= new Date().getFullYear() %> BikeRental</p>
    </div>
    <div class="footer-section">
      <h3>Links</h3>
      <p><a href="/">Home</a></p>
      <p><a href="/login">Login</a></p>
      <p><a href="/signup">Signup</a></p>
    </div>
    <div class="footer-section">
      <h3>Contact</h3>
      <p>Email: support@bikerental.com</p>
      <p>Phone: +91 9876543210</p>
      <p>Address: 123 Main St, City</p>
    </div>
    <div class="footer-section">
      <h3>Feedback</h3>
      <form action="/feedback" method="POST">
        <input type="text" name="name" placeholder="Your Name" required style="width:100%; margin-bottom:5px; padding:5px;">
        <input type="email" name="email" placeholder="Email" required style="width:100%; margin-bottom:5px; padding:5px;">
        <textarea name="message" placeholder="Your feedback" required style="width:100%; padding:5px;"></textarea>
        <button type="submit" class="btn" style="margin-top:5px;">Send</button>
      </form>
    </div>
  </footer>

</body>
</html>
